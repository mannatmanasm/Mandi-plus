## What Changed

- **Invoice PDF Regeneration Endpoint**
  - Added `RegenerateInvoiceDto` (`invoiceId` + partial invoice fields) to allow updating an invoice and regenerating its PDF in a single call.
  - Added `POST /invoices/regenerate` controller endpoint that accepts `multipart/form-data` with optional weighment slip file uploads.
  - Implemented `InvoicesService.regenerateInvoiceAndPdf()` which updates invoice data, handles weighment slip uploads (replaces existing), and queues PDF regeneration.

- **Upload Weighment Slips Endpoint** (NEW)
  - Added `POST /invoices/:id/weighment-slips` endpoint specifically for uploading weighment slips.
  - New weighment slips **replace** all existing ones in the database.
  - Automatically regenerates PDF with only the new weighment slips.
  - Simpler API when you only need to update weighment slips without changing other invoice data.

## Why It Changed

- Needed a simple way for the client to send an `invoiceId` and updated invoice details in one payload.
- Required a dedicated API to trigger invoice data update and PDF regeneration.
- Need for a focused endpoint to update only weighment slips without sending all invoice data.
- Requirement to replace old weighment slips with new ones and regenerate PDF accordingly.

## How It Affects the Current Code

- New DTO: `RegenerateInvoiceDto` in the invoices DTO folder.
- New endpoint: `POST /invoices/regenerate` (multipart/form-data with `invoiceId` in body and optional `weighmentSlips` files).
- New endpoint: `POST /invoices/:id/weighment-slips` (multipart/form-data with only `weighmentSlips` files).
- New service method: `InvoicesService.uploadWeighmentSlips()` - handles weighment slip uploads and PDF regeneration.
- Existing PDF generation flow is reused: after the invoice is updated, the `invoice-pdf` queue job regenerates the PDF (using `invoice.weighmentSlipUrls`) and updates `pdfUrl` on the invoice.
- Weighment slip handling: New weighment slips uploaded via these endpoints **replace** existing ones (not append).

## Developer Notes

### Regenerate Invoice Endpoint

- To use the regenerate endpoint, send a `multipart/form-data` request:
  ```typescript
  const formData = new FormData();
  formData.append('invoiceId', invoiceId);
  formData.append('supplierName', 'Updated Supplier');
  formData.append('weighmentSlips', file1); // Optional
  ```

- The service will:
  - Load and update the invoice with the provided fields.
  - Replace weighment slips if new ones are uploaded.
  - Queue a new `generate-pdf` job for that invoice.
  - Save the updated `pdfUrl` when the job completes.

### Upload Weighment Slips Endpoint

- To upload only weighment slips:
  ```typescript
  const formData = new FormData();
  formData.append('weighmentSlips', file1);
  formData.append('weighmentSlips', file2);
  
  fetch(`/invoices/${invoiceId}/weighment-slips`, {
    method: 'POST',
    body: formData,
  });
  ```

- The service will:
  - Upload new weighment slip files to cloud storage.
  - **Replace** all existing weighment slip URLs with new ones in the database.
  - Queue PDF regeneration job.
  - The regenerated PDF will contain **only** the new weighment slips (old ones are removed from DB).



